# Архитектура проекта Code Analyzer

## Общая архитектура
Проект построен на основе ASP.NET Core с использованием Razor Pages. Архитектура следует принципам чистой архитектуры с разделением на слои:

1. **Презентационный слой** (Razor Pages)
   - Взаимодействие с пользователем
   - Загрузка файлов
   - Отображение результатов анализа и визуализаций
   - Кнопка генерации PDF-отчета

2. **Слой бизнес-логики** (Core, Services)
   - Логика анализа кода и расчет метрик
   - Генерация PDF-отчетов с графиками
   - Генерация изображений графиков для метрик

3. **Слой моделей** (Models)
   - Структуры данных для хранения результатов анализа и метрик

4. **Контроллеры**
   - Обработка API-запросов (например, генерация PDF-отчета)

## Ключевые компоненты системы

### Презентационный слой
- `Pages/Index.cshtml` — Главная страница (загрузка файла, описание метрик)
- `Pages/Analysis.cshtml` — Страница результатов анализа (метрики, визуализации, кнопка "Напечатать отчет")
- `Pages/Visualization.cshtml` — Страница с интерактивными графиками

### Слой бизнес-логики и сервисы
- `ICodeAnalyzer` — Интерфейс анализатора кода
- `CSharpAnalyzer`, `JavaAnalyzer`, `CppAnalyzer` — реализации анализаторов
- `MetricsCalculator` — расчет метрик (Холстеда, Чепина, Джилба и др.)
- `PdfReportService` — сервис для генерации PDF-отчетов с помощью QuestPDF
- `ChartImageService` — сервис для генерации изображений графиков (столбчатые и круговые диаграммы) с помощью ScottPlot
- `MetricsVisualizationService` — вспомогательный сервис для подготовки данных к визуализации

### Контроллеры
- `ReportController` — API-контроллер для генерации и скачивания PDF-отчета

### Модели данных
- `AnalysisResult` — основная модель результатов анализа
- `HalsteadMetrics`, `ChepinMetrics`, `GilbMetrics` — модели метрик

## Визуализация и отчеты
- Визуализация метрик на странице результатов и в PDF-отчете:
  - Столбчатые диаграммы для метрик Холстеда, Чепина, Джилба
  - Круговая диаграмма распределения переменных по метрике Чепина
  - Диаграмма предсказания ошибок
- PDF-отчет содержит все ключевые метрики, предупреждения и графики
- Для генерации PDF используется библиотека **QuestPDF**
- Для построения графиков используется **ScottPlot**

## Поток данных
1. Пользователь загружает файл
2. Файл анализируется выбранным анализатором
3. Метрики рассчитываются и сохраняются в сессии
4. Пользователь видит результаты и визуализации на странице анализа
5. По нажатию кнопки "Напечатать отчет" формируется PDF с метриками и графиками, который скачивается и открывается

## Зависимости
- ASP.NET Core 8.0
- QuestPDF (PDF-отчеты)
- ScottPlot (графики)
- Bootstrap 5 (UI)
- System.Text.Json (сериализация)

## Расширяемость
- Легко добавить новые языки программирования (реализация ICodeAnalyzer)
- Легко добавить новые метрики и визуализации
- Гибкая генерация отчетов и расширение их структуры 